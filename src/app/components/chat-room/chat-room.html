<div class="chat-room-container">
  <!-- Header -->
  <div class="chat-header">
    <div class="header-left">
      <button (click)="goBack()" class="back-button">
        <span class="back-icon">â†</span>
        <span class="back-text">Quay láº¡i</span>
      </button>
    </div>
    <div class="header-center">
      <h1 class="room-title">{{ room?.name || 'Äang táº£i...' }}</h1>
      <div class="room-status">
        <span class="status-dot online"></span>
        <span class="status-text">Äang hoáº¡t Ä‘á»™ng</span>
      </div>
    </div>
    <div class="header-right">
      <div class="online-indicator">
        <span class="indicator-icon">ğŸ‘¥</span>
        <span class="indicator-text">Online</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="chat-content">
    <!-- Password Modal -->
    <div *ngIf="showPasswordModal" class="password-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">
            <span class="modal-icon">ğŸ”’</span>
            PhÃ²ng Ä‘Æ°á»£c báº£o vá»‡
          </h2>
          <p class="modal-description">Nháº­p máº­t kháº©u Ä‘á»ƒ vÃ o phÃ²ng</p>
        </div>
        <div class="modal-body">
          <form [formGroup]="passwordForm" (ngSubmit)="verifyPassword()" class="password-form">
            <div class="form-group">
              <input
                type="password"
                formControlName="password"
                class="form-input"
                placeholder="Nháº­p máº­t kháº©u..."
                [class.error]="password?.invalid && password?.touched"
              />
              <div *ngIf="password?.invalid && password?.touched" class="error-message">
                <span *ngIf="password?.errors?.['required']">Máº­t kháº©u lÃ  báº¯t buá»™c</span>
              </div>
            </div>
            <button
              type="submit"
              class="btn-primary btn-lg w-full"
              [disabled]="passwordForm.invalid"
            >
              XÃ¡c nháº­n
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Username Form -->
    <div *ngIf="!currentUsername && !isPasswordRequired" class="username-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">
            <span class="modal-icon">ğŸ‘‹</span>
            ChÃ o má»«ng báº¡n!
          </h2>
          <p class="modal-description">Nháº­p tÃªn Ä‘á»ƒ báº¯t Ä‘áº§u trÃ² chuyá»‡n</p>
        </div>
        <div class="modal-body">
          <form [formGroup]="usernameForm" (ngSubmit)="setUsername()" class="username-form">
            <div class="form-group">
              <input
                type="text"
                formControlName="username"
                class="form-input"
                placeholder="Nháº­p tÃªn cá»§a báº¡n..."
                [class.error]="username?.invalid && username?.touched"
              />
              <div *ngIf="username?.invalid && username?.touched" class="error-message">
                <span *ngIf="username?.errors?.['required']">TÃªn lÃ  báº¯t buá»™c</span>
              </div>
            </div>
            <button
              type="submit"
              class="btn-primary btn-lg w-full"
              [disabled]="usernameForm.invalid"
            >
              Báº¯t Ä‘áº§u chat
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-banner">
      <span class="error-icon">âš ï¸</span>
      {{ errorMessage }}
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Äang táº£i tin nháº¯n...</p>
    </div>

    <!-- Messages Container -->
    <div class="messages-container" *ngIf="!isLoading && currentUsername && !isPasswordRequired">
      <!-- Empty State -->
      <div *ngIf="messages.length === 0" class="empty-messages">
        <div class="empty-icon">ğŸ’¬</div>
        <h3>ChÆ°a cÃ³ tin nháº¯n nÃ o</h3>
        <p>HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn gá»­i tin nháº¯n!</p>
      </div>

      <!-- Messages List -->
      <div class="messages-list" *ngIf="messages.length > 0">
        <div *ngFor="let message of messages; trackBy: trackByMessageId" class="message-item">
          <div class="message-content">
            <div class="message-text">{{ message.content }}</div>
            <div class="message-meta">
              <span class="message-time">{{ message.created_at | date:'HH:mm' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Message Input -->
    <div class="message-input-container" *ngIf="currentUsername && !isPasswordRequired">
      <form [formGroup]="messageForm" (ngSubmit)="sendMessage()" class="message-form">
        <div class="input-group">
          <div class="input-wrapper">
            <input
              type="text"
              formControlName="content"
              class="message-input"
              placeholder="Nháº­p tin nháº¯n..."
              [class.error]="content?.invalid && content?.touched"
            />
          </div>
          <button
            type="submit"
            class="send-button"
            [disabled]="messageForm.invalid"
          >
            <span class="send-icon">ğŸ“¤</span>
          </button>
        </div>
        <div *ngIf="content?.invalid && content?.touched" class="error-message">
          <span *ngIf="content?.errors?.['required']">Tin nháº¯n lÃ  báº¯t buá»™c</span>
        </div>
      </form>
    </div>
  </div>
</div>
